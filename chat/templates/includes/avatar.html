{% comment %}
    This template snippet demonstrates how to use the CSS-based animated avatars
    Include this in your Django template where you want to show user avatars
{% endcomment %}

{% load static %}

{# Add this to your head or include it in your CSS file #}
<link rel="stylesheet" href="{% static 'css/animated_avatars.css' %}">

{# Function to render an avatar based on profile_picture_data #}
{% comment %}
  This is a template tag you can add to your templatetags folder.
  Create a file named avatar_tags.py in your app's templatetags directory.
{% endcomment %}

{#
In your app/templatetags/avatar_tags.py:

from django import template
import json

register = template.Library()

@register.inclusion_tag('includes/avatar.html')
def render_avatar(user, size='medium'):
    """Render an animated avatar for a user"""
    try:
        if hasattr(user, 'profile') and user.profile.profile_picture_data:
            avatar_data = json.loads(user.profile.profile_picture_data)
        else:
            # Fallback for users without profile picture data
            avatar_data = {
                'type': 'gradient',
                'initials': user.username[0:2].upper() if user.username else '?',
                'colors': ['bg-blue-500', 'bg-indigo-500'],
                'animation_type': 'slide',
                'animation_duration': '5s',
                'text_color': 'text-white'
            }

        return {
            'avatar_data': avatar_data,
            'size': size
        }
    except Exception as e:
        # Fallback on error
        return {
            'avatar_data': {
                'type': 'gradient',
                'initials': user.username[0:2].upper() if user.username else '?',
                'colors': ['bg-blue-500', 'bg-indigo-500'],
                'text_color': 'text-white'
            },
            'size': size
        }
#}

{# In your templates/includes/avatar.html: #}
{% comment %}
<div class="avatar
    {% if size == 'large' %}large{% elif size == 'small' %}small{% endif %}
    {% if avatar_data.type == 'gradient' %}
        avatar-gradient {{ avatar_data.animation_type }}
    {% elif avatar_data.type == 'pulse' %}
        avatar-pulse {{ avatar_data.background }}
    {% elif avatar_data.type == 'spinner' %}
        avatar-spinner {{ avatar_data.background }}
    {% elif avatar_data.type == 'border' %}
        avatar-border {{ avatar_data.background }}
    {% elif avatar_data.type == 'shine' %}
        avatar-shine {{ avatar_data.background }}
    {% else %}
        {{ avatar_data.background|default:"bg-blue-500" }}
    {% endif %}
    {{ avatar_data.text_color|default:"text-white" }}"
    style="
        {% if avatar_data.type == 'gradient' %}
            background: linear-gradient(45deg,
                var(--{{ avatar_data.colors.0|cut:'bg-' }}, #3b82f6),
                var(--{{ avatar_data.colors.1|cut:'bg-' }}, #6366f1));
            --animation-duration: {{ avatar_data.animation_duration|default:'5s' }};
        {% elif avatar_data.type == 'pulse' %}
            --animation-duration: {{ avatar_data.animation_duration|default:'3s' }};
        {% elif avatar_data.type == 'spinner' %}
            --animation-duration: {{ avatar_data.animation_duration|default:'5s' }};
            --spinner-color: var(--{{ avatar_data.spinner_color|cut:'border-' }}, #ffffff);
        {% elif avatar_data.type == 'border' %}
            --animation-duration: {{ avatar_data.animation_duration|default:'4s' }};
            --border-width: {{ avatar_data.border_width|default:'3px' }};
            --border-color: var(--{{ avatar_data.border_color|cut:'border-' }}, #3b82f6);
            --border-color-alt: var(--{{ avatar_data.border_color|cut:'border-' }}, #10b981);
            --border-color-alt2: var(--{{ avatar_data.border_color|cut:'border-' }}, #ef4444);
        {% elif avatar_data.type == 'shine' %}
            --animation-duration: {{ avatar_data.animation_duration|default:'6s' }};
        {% endif %}
    "
>
    {{ avatar_data.initials }}
</div>
{% endcomment %}

{# Example usage in your templates: #}

{# Load the template tag at the top of your template #}
{% comment %}
{% load avatar_tags %}
{% endcomment %}

{# Here's how you might use this in a user list #}
<div class="user-list">
    {% for user in users %}
        <div class="user-item">
            {# Use the template tag to render the avatar #}
            {% comment %}
            {% render_avatar user size="medium" %}
            {% endcomment %}

            {# For testing purposes, here's how to render an avatar directly #}
            <div class="avatar
                {% if user.profile.profile_picture_data.type == 'gradient' %}
                    avatar-gradient slide
                    bg-blue-500
                {% elif user.profile.profile_picture_data.type == 'pulse' %}
                    avatar-pulse bg-purple-500
                {% elif user.profile.profile_picture_data.type == 'spinner' %}
                    avatar-spinner bg-green-500
                {% elif user.profile.profile_picture_data.type == 'border' %}
                    avatar-border bg-amber-400
                {% elif user.profile.profile_picture_data.type == 'shine' %}
                    avatar-shine bg-rose-400
                {% else %}
                    bg-blue-500
                {% endif %}
                text-white"
                style="--animation-duration: 5s; --spinner-color: white; --border-width: 3px;"
            >
                {{ user.username|slice:":2"|upper }}
            </div>
            <span class="username">{{ user.username }}</span>
        </div>
    {% endfor %}
</div>

{# Example of rendering a single user's avatar in a chat bubble #}
<div class="message-container">
    <div class="avatar-container">
        {% comment %}
        {% render_avatar message.user size="small" %}
        {% endcomment %}

        <div class="avatar small
            avatar-gradient slide
            text-white"
            style="background: linear-gradient(45deg, #3b82f6, #6366f1); --animation-duration: 5s;"
        >
            {{ message.user.username|slice:":2"|upper }}
        </div>
    </div>
    <div class="message-content">
        <div class="username">{{ message.user.username }}</div>
        <div class="message-text">{{ message.content }}</div>
    </div>
</div>
